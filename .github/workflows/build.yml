name: æ„å»º KDENGINE APK

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® JDK 11
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '11'

      - name: è§£å‹æºç 
        run: |
          unzip -o KD_ENGINE-src.zip
          rm -f KD_ENGINE-src.zip

      # ğŸ”¥ å¼ºåˆ¶å°† Gradle Wrapper æ”¹ä¸º 7.2ï¼ˆæ— è®ºåŸæ–‡ä»¶æ˜¯ä»€ä¹ˆï¼‰
      - name: å¼ºåˆ¶ä½¿ç”¨ Gradle 7.2
        run: |
          sed -i 's#distributionUrl=.*#distributionUrl=https\\://services.gradle.org/distributions/gradle-7.2-bin.zip#' gradle/wrapper/gradle-wrapper.properties
          echo "âœ… å·²å¼ºåˆ¶è®¾ç½®ä¸º Gradle 7.2"
          cat gradle/wrapper/gradle-wrapper.properties

      - name: èµ‹äºˆæ‰§è¡Œæƒé™
        run: chmod +x gradlew

      - name: æ¥å— Android SDK è®¸å¯è¯
        run: |
          mkdir -p $ANDROID_SDK_ROOT/licenses
          echo "8933bad161af4178b1185d1a37fbf41ea5269c55" > $ANDROID_SDK_ROOT/licenses/android-sdk-license
          echo "d56f5187479451eabf01fb78af6dfcb131a6481e" > $ANDROID_SDK_ROOT/licenses/android-sdk-arm-dbt-license
          echo "84831b9409646a918e30573bab4c9c91346d8abd" > $ANDROID_SDK_ROOT/licenses/android-sdk-preview-license

      # ğŸ”¥ ä¸å†ä¾èµ– wrapper å‘½ä»¤ï¼Œç›´æ¥ç¼–è¯‘
      - name: ç¼–è¯‘ APK
        run: ./gradlew assembleDebug --no-daemon --stacktrace

      - name: ä¸Šä¼  APK
        uses: actions/upload-artifact@v4
        with:
          name: KDENGINE-debug
          path: app/build/outputs/apk/debug/app-debug.apk
