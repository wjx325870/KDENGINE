name: æ„å»º KDENGINE APK

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      # ğŸ”¥ å…³é”®ï¼šä½¿ç”¨ JDK 8ï¼ˆ1.8ï¼‰ï¼Œå®Œç¾å…¼å®¹è€å·¥ç¨‹
      - name: è®¾ç½® JDK 8
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '8'

      - name: æŸ¥çœ‹å½“å‰ç›®å½•æ–‡ä»¶
        run: ls -la

      - name: è§£å‹æºç 
        run: |
          unzip -o KD_ENGINE-src.zip
          rm -f KD_ENGINE-src.zip

      - name: æŸ¥çœ‹è§£å‹åæ ¹ç›®å½•
        run: ls -la

      - name: èµ‹äºˆæ‰§è¡Œæƒé™
        run: chmod +x gradlew

      # ğŸ”¥ ä½¿ç”¨ Gradle 7.2ï¼ˆå…¼å®¹ JDK 8 å’Œ Android Gradle Plugin 4.2.1ï¼‰
      - name: ä½¿ç”¨ Gradle 7.2
        run: ./gradlew wrapper --gradle-version 7.2 --distribution-type bin

      # ğŸ”¥ æ¥å— Android SDK è®¸å¯è¯
      - name: æ¥å— Android SDK è®¸å¯è¯
        run: yes | $ANDROID_SDK_ROOT/cmdline-tools/latest/bin/sdkmanager --licenses || true

      # ğŸ”¥ ç¼–è¯‘ Debug APKï¼Œè¾“å‡ºå®Œæ•´é”™è¯¯æ—¥å¿—
      - name: ç¼–è¯‘ APK
        run: ./gradlew assembleDebug --stacktrace --info

      - name: ä¸Šä¼  APK
        uses: actions/upload-artifact@v4
        with:
          name: KDENGINE-debug
          path: app/build/outputs/apk/debug/app-debug.apk
